___INFO___

{
  "displayName": "Yandex Metrica",
  "author": "David Vallejo",
  "author_contact": "hola@thyngster.com",
  "description": "Yandex Metrica Custom Template",
  "author_twitter": "@thyng",
  "type": "TAG",
  "version": 1,
  "update_date": "2019-06-14 15:15",
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "brand": {
    "thumbnail": "data:image/jpeg;base64,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",
    "displayName": "",
    "id": "brand_dummy"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "macrosInSelect": false,
    "selectItems": [
      {
        "displayValue": "Init",
        "value": "init"
      },
      {
        "displayValue": "Outbound Link",
        "value": "extLink"
      },
      {
        "displayValue": "File Download",
        "value": "file"
      },
      {
        "displayValue": "Reach Goal",
        "value": "reachGoal"
      },
      {
        "displayValue": "Hit",
        "value": "hit"
      },
      {
        "displayValue": "Session Parameters",
        "value": "params"
      },
      {
        "displayValue": "User Parameters",
        "value": "userParams"
      },
      {
        "displayValue": "User ID",
        "value": "setUserID"
      },
      {
        "displayValue": "notBounce",
        "value": "notBounce"
      }
    ],
    "displayName": "Method",
    "simpleValueType": true,
    "name": "method",
    "type": "SELECT"
  },
  {
    "alwaysInSummary": false,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "POSITIVE_NUMBER"
      }
    ],
    "displayName": "Account ID",
    "simpleValueType": true,
    "name": "account_id",
    "type": "TEXT"
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "reachGoal"
      }
    ],
    "displayName": "",
    "name": "reachGoal_options",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "Goal Tracking Parameters",
        "name": "Goal Tracking Parameters",
        "type": "LABEL"
      },
      {
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "displayName": "Goal Target Name",
        "simpleValueType": true,
        "name": "reachGoal_target",
        "type": "TEXT"
      },
      {
        "valueValidators": [],
        "displayName": "Goal Order Price",
        "simpleValueType": true,
        "name": "reachGoal_order_price",
        "type": "TEXT"
      },
      {
        "macrosInSelect": true,
        "selectItems": [
          {
            "displayValue": "EUR",
            "value": "EUR"
          },
          {
            "displayValue": "USD",
            "value": "USD"
          },
          {
            "displayValue": "RUB",
            "value": "RUB"
          },
          {
            "displayValue": "YND",
            "value": "YND"
          }
        ],
        "displayName": "Goal Currency",
        "simpleValueType": true,
        "name": "reachGoal_currency",
        "type": "SELECT"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "extLink"
      }
    ],
    "displayName": "",
    "name": "extLink_method_options",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "Links Tracking Parameters",
        "name": "Links Tracking Parameters",
        "type": "LABEL"
      },
      {
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "displayName": "Link URL",
        "simpleValueType": true,
        "name": "extLink_url",
        "type": "TEXT"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "file"
      }
    ],
    "displayName": "",
    "name": "file_method_options",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "File Tracking Parameters",
        "name": "File Tracking Parameters",
        "type": "LABEL"
      },
      {
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "displayName": "File URL",
        "simpleValueType": true,
        "name": "file_url",
        "type": "TEXT"
      },
      {
        "displayName": "File Referrer",
        "simpleValueType": true,
        "name": "file_referrer",
        "type": "TEXT"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "notBounce"
      }
    ],
    "displayName": "",
    "name": "notBounce_method_options",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "This method doesn't require further configurations",
        "name": "notBounce_text",
        "type": "LABEL"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "hit"
      }
    ],
    "displayName": "",
    "name": "hit_method_options",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "File Tracking Parameters",
        "name": "HitTracking Parameters",
        "type": "LABEL"
      },
      {
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "displayName": "File URL",
        "simpleValueType": true,
        "name": "hit_url",
        "type": "TEXT"
      },
      {
        "displayName": "Referrer",
        "simpleValueType": true,
        "name": "hit_referrer",
        "type": "TEXT"
      },
      {
        "displayName": "Title",
        "simpleValueType": true,
        "name": "hit_title",
        "type": "TEXT"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "init"
      }
    ],
    "displayName": "Tracker Options",
    "name": "init_options",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "help": "Whether to disable automatically sending data during tag initialization. This is useful when working with SPA pages.",
        "simpleValueType": true,
        "name": "defer",
        "checkboxText": "Disable default Data Sending",
        "type": "CHECKBOX"
      },
      {
        "help": "Hash tracking in the browser address bar",
        "simpleValueType": true,
        "name": "trackHash",
        "checkboxText": "Enable HashTracking",
        "type": "CHECKBOX"
      },
      {
        "help": "Prohibits sending information about the page's existence to Yandex search robots.  Using this parameter doesn't guarantee that the page won't be indexed. A robot can get information about a page's existence from other sources.",
        "simpleValueType": true,
        "name": "ut",
        "checkboxText": "Send Page To Yandex Index",
        "type": "CHECKBOX"
      },
      {
        "help": "Allows you to correctly register sessions from regions in which access to Yandex resources is restricted. Using this option may affect the loading speed of the code snippet.",
        "simpleValueType": true,
        "name": "alternative_cdn",
        "checkboxText": "Alternative CDN",
        "type": "CHECKBOX"
      },
      {
        "help": "The following section allows you to setup the tracker initialization parameters.",
        "displayName": "Options",
        "name": "Initialization Options",
        "groupStyle": "NO_ZIPPY",
        "type": "GROUP",
        "subParams": [
          {
            "displayName": "Tracking Features",
            "name": "Tracking Features",
            "groupStyle": "ZIPPY_CLOSED",
            "type": "GROUP",
            "subParams": [
              {
                "help": "Accurate bounce rate The parameter can accept these values:  <br />true — Enable the accurate bounce rate, with a non-bounce event registered after 15000 ms (15 s). false — Do not enable the accurate bounce rate. <N> (integer) — Enable the accurate bounce rate, with a non-bounce event registered after <N> ms. <a href=\"https://yandex.com/support/metrica/code/counter-initialize.html\">Read More</a>",
                "macrosInSelect": true,
                "selectItems": [
                  {
                    "displayValue": "False",
                    "value": false
                  },
                  {
                    "displayValue": "True",
                    "value": true
                  }
                ],
                "displayName": "Accurate Track Bounce",
                "defaultValue": false,
                "simpleValueType": true,
                "name": "accurateTrackBounce",
                "type": "SELECT"
              },
              {
                "help": "Whether to collect data for a click map\n<a href=\"https://yandex.com/support/metrica/code/counter-initialize.html\">Read More</a>",
                "macrosInSelect": false,
                "selectItems": [
                  {
                    "displayValue": "False",
                    "value": false
                  },
                  {
                    "displayValue": "True",
                    "value": true
                  }
                ],
                "displayName": "Click Map",
                "defaultValue": false,
                "simpleValueType": true,
                "name": "clickmap",
                "type": "SELECT"
              },
              {
                "help": "Track clicks on outbound links. \n<a href=\"https://yandex.com/support/metrica/code/counter-initialize.html\">Read More</a>",
                "macrosInSelect": false,
                "selectItems": [
                  {
                    "displayValue": "False",
                    "value": false
                  },
                  {
                    "displayValue": "True",
                    "value": true
                  }
                ],
                "displayName": "Track Links",
                "defaultValue": false,
                "simpleValueType": true,
                "name": "trackLinks",
                "type": "SELECT"
              },
              {
                "help": "List of file extensions to be tracked separated by commas. ( <a href=\"https://yandex.com/support/metrica/objects/addfileextension.html#addfileextension__extensions\">More Info</a> )",
                "enablingConditions": [],
                "valueValidators": [],
                "displayName": "Supported File Extensions",
                "defaultValue": "",
                "simpleValueType": true,
                "name": "addFileExtension",
                "type": "TEXT"
              },
              {
                "help": "Whether to use Session Replay. \n<a href=\"https://yandex.com/support/metrica/code/counter-initialize.html\">Read More</a>",
                "selectItems": [
                  {
                    "displayValue": "False",
                    "value": false
                  },
                  {
                    "displayValue": "True",
                    "value": true
                  }
                ],
                "displayName": "Webvisor",
                "defaultValue": false,
                "simpleValueType": true,
                "name": "webvisor",
                "type": "SELECT"
              }
            ]
          }
        ]
      },
      {
        "displayName": "More Options",
        "name": "More Options",
        "groupStyle": "ZIPPY_CLOSED",
        "type": "GROUP",
        "subParams": [
          {
            "macrosInSelect": false,
            "selectItems": [
              {
                "displayValue": "No",
                "value": false
              },
              {
                "displayValue": "Yes",
                "value": true
              }
            ],
            "displayName": "Enable Debug",
            "defaultValue": false,
            "simpleValueType": true,
            "name": "debug",
            "type": "SELECT"
          },
          {
            "enablingConditions": [
              {
                "paramName": "method",
                "type": "EQUALS",
                "paramValue": "init"
              }
            ],
            "displayName": "Ecommerce",
            "name": "ecommerce",
            "groupStyle": "NO_ZIPPY",
            "type": "GROUP",
            "subParams": [
              {
                "simpleValueType": true,
                "name": "ecommerce_enabled",
                "checkboxText": "Enabled",
                "type": "CHECKBOX"
              },
              {
                "enablingConditions": [
                  {
                    "paramName": "ecommerce_enabled",
                    "type": "EQUALS",
                    "paramValue": true
                  }
                ],
                "displayName": "data layer name",
                "defaultValue": "dataLayer",
                "simpleValueType": true,
                "name": "ecommerce_datalayer_name",
                "type": "TEXT"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "params"
      }
    ],
    "displayName": "Session Parameters",
    "name": "params_options",
    "groupStyle": "ZIPPY_OPEN",
    "type": "GROUP",
    "subParams": [
      {
        "notSetText": "This method needs to have at least 1 parameter to work",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "displayName": "",
        "name": "session_params_list",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Session Parameter Key",
            "name": "session_params_key",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Session Parameter Value",
            "name": "session_params_value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add New Session Parameter"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "userParams"
      }
    ],
    "displayName": "User Parameters",
    "name": "userParams_options",
    "groupStyle": "ZIPPY_OPEN",
    "type": "GROUP",
    "subParams": [
      {
        "notSetText": "This method needs to have at least 1 parameter to work",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "displayName": "",
        "name": "user_params_list",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "User Parameter Key",
            "name": "user_params_key",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "User Parameter Value",
            "name": "user_params_value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add New User Parameter"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "setUserID"
      }
    ],
    "displayName": "user ID Tracking Parameters",
    "name": "setUserID_options",
    "groupStyle": "ZIPPY_OPEN",
    "type": "GROUP",
    "subParams": [
      {
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "displayName": "user ID",
        "simpleValueType": true,
        "name": "setUserID",
        "type": "TEXT"
      }
    ]
  }
]


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://mc.yandex.ru/metrika/tag.js"
              },
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/npm/yandex-metrica-watch/tag.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ym"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ym.a"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_ym_debug"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "/"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Yandex Metrica Custom Template
// David Vallejo ( 2019-06-14 )

// Load Needed Libraries
// Logging Library
const log = require('logToConsole');
// Library to inject JS files into the page
const injectScript = require('injectScript');
// Library to call a window variable
const callInWindow = require('callInWindow');
// Library to create an array variable
const createQueue = require('createQueue');
// Library to set cookies
const setCookie = require('setCookie');
// Library to create a window. available arguments queue
const createArgumentsQueue = require('createArgumentsQueue');
// Library to convert tables to maps
const makeTableMap = require('makeTableMap');

// Hold Main Params
let params = {};

// Create global object queue
const ym = createArgumentsQueue('ym', 'ym.a');
// Grab hit type
const track_type = data.method;

// Build Up Sessions Parameters list
const session_params_list = data.session_params_list ? makeTableMap(data.session_params_list, 'session_params_key', 'session_params_value') : {};
const user_params_list = data.user_params_list ? makeTableMap(data.user_params_list, 'user_params_key', 'user_params_value') : {}; 

switch (track_type) {
  case 'init':
    // Debug Enabler/Disabler
    if(data.debug){
        setCookie('_ym_debug', '1' ,{
            domain: 'auto',
            path: '/'    
        });   
    }else{
        setCookie('_ym_debug', '0' ,{
            domain: 'auto',
            path: '/',
            expires: 'Thu, 01 Jan 1970 00:00:01 GMT'
        });   
    }    
    
    // The following two lines take care of loading Yandex Tracking JS Library
    let yandex_js_api_lib = 'https://mc.yandex.ru/metrika/tag.js';
    if(data.alternative_cdn===true) yandex_js_api_lib = 'https://cdn.jsdelivr.net/npm/yandex-metrica-watch/tag.js';
  injectScript(yandex_js_api_lib, data.gtmOnSuccess, data.gtmOnFailure, yandex_js_api_lib);
        
    // All is initialized, now we'll be reading the configuration values from the tag setup
    // and pushing it back to Yandex Metrica Object    
    ym(data.account_id,'init',{
     clickmap: data.clickmap,
     webvisor: data.webvisor,
     accurateTrackBounce: data.accurateTrackBounce,
     trackLinks: data.trackLinks,
     ut: data.ut,  
     defer: data.defer,
     ecommerce: data.ecommerce_enabled
    });
    if(data.trackLinks===true && data.addFileExtension!==undefined){
      data.addFileExtension = data.addFileExtension.split(',');
      if(data.addFileExtension.length===1) data.addFileExtension = data.addFileExtension[0];
    }
    break;
  // Goals Tracking Method Setup    
  case 'reachGoal':    
    if(data.reachGoal_order_price) params.reachGoal_order_price = data.reachGoal_order_price;
    if(data.reachGoal_currency) params.reachGoal_currency = data.reachGoal_currency;    
    ym(data.account_id,'reachGoal', data.reachGoal_target,params);  
    break;
  // Links Tracking Method Setup
  case 'extLink':
    if(data.extLink_title) params.title = data.extLink_title;
    ym(data.account_id,'extLink',data.extLink_url,params);  
    break; 
  // Files Tracking Method Setup    
  case 'file':
  if(data.file_referrer) params.title = data.file_referrer;    
    ym(data.account_id,'file',data.file_url,params);  
    break;    
  // Hits Tracking Method Setup    
  case 'hit':
    if(data.hit_title) params.title = data.hit_title;
  if(data.hit_referrer) params.title = data.hit_referrer;    
    ym(data.account_id,'hit',data.file_url,params); 
    break;
  // Session Parameters Tracking Method Setup    
  case 'params':
  ym(data.account_id,'params',session_params_list);    
    break;     
  // User Parameters Tracking Method Setup  
  case 'userParams':
    ym(data.account_id,'userParams',user_params_list);
    break;
  // User ID Tracking Method Setup  
  case 'setUserID':
    if(data.setUserID) ym(data.account_id,'setUserID',data.setUserID);
    break;    
  // Not Bounce Tracking Method Setup    
  case 'notBounce':
    ym(data.account_id,'notBounce');
    break;     
  default:
    break;
}
data.gtmOnSuccess();


___NOTES___

Created on 14/6/2019 15:16:08
